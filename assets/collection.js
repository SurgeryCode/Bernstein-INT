if(!customElements.get("collection-section")){class a extends HTMLElement{constructor(){super(),window.collectionBind||(this.is_loading=!1,this.query=new URLSearchParams(window.location.search),this.base_url=this.getAttribute("data-base-url"),this.content=this.querySelector(".listing__content"),this.grid=this.querySelector(".listing__grid"),this.grid_button=this.querySelectorAll("[data-change-grid]"),this.current_filters=this.querySelector(".filters__main"),this.current_chips=this.querySelector(".listing__toolbar-filters"),this.count=this.querySelector(".listing__toolbar-count"),this.button_filters=this.querySelector(".filters__button"),this.layout=localStorage.getItem("bernstein-grid-layout")?localStorage.getItem("bernstein-grid-layout"):"vertical",this.count_filters=document.querySelectorAll("[data-filters-count]"),this.pagination=this.querySelector(".pagination"),this.drawer=document.querySelector(".drawer .filters"),this.grid_button.forEach(e=>{e.addEventListener("click",()=>{localStorage.setItem("bernstein-grid-layout",e.getAttribute("data-change-grid")),this.layout=e.getAttribute("data-change-grid"),this.changeLayout()})}),this.bindFilters(),this.changeLayout(),this.updateCounter(),localStorage.removeItem("stackFilters"),window.addEventListener("popstate",e=>{var t=localStorage.getItem("stackFilters")?JSON.parse(localStorage.getItem("stackFilters")):[];if(0<t.length){const r=t[t.length-1];"checkbox"!=r.type&&"radio"!=r.type||document.querySelectorAll(`input[name="${r.name}"][value="${r.value}"]`).forEach(e=>{e.checked=r.checked}),"number"==r.type&&document.querySelectorAll(`input[name="${r.name}"]`).forEach(e=>{e.value=r.value})}this.updateQuery(),this.fetchProducts(),this.popHistory()}),window.collectionBind=!0)}changeLayout(){this.grid&&(this.grid_button.forEach(e=>{e.getAttribute("data-change-grid")==this.layout?e.setAttribute("aria-selected","true"):e.setAttribute("aria-selected","false")}),this.grid.classList.remove("listing__grid--horizontal"),this.grid.classList.remove("listing__grid--vertical"),this.grid.classList.add("listing__grid--"+this.layout))}updateQuery(){let e=!1;this.query.has("q")&&(e=this.query.get("q")),this.query=new URLSearchParams,this.filters.forEach(t=>{"checkbox"==t.type||"radio"==t.type?t.checked&&this.query.append(t.name,t.value):0<t.value.length&&(t.getAttribute("data-real-values")?t.value.split(";").forEach(e=>{this.query.append(t.name,e)}):this.query.append(t.name,t.value))}),this.query.forEach((e,t)=>{-1!=e.indexOf(",")&&(this.query.delete(t,e),e.split(",").forEach(e=>{this.query.append(t,e)}))}),this.query.set("page",1),this.query.set("view","all"),e&&(this.query.set("q",e),this.query.set("type","product"))}updateURL(){var e=this.query.toString(),e=this.base_url+"?"+e;history.pushState(null,"",e)}removeFilter(t){this.filters=this.querySelectorAll("input[name]"),this.drawer_filters=document.querySelectorAll(".drawer .filters input[name]"),this.filters.forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.id==t&&(e.checked=!1,e.dispatchEvent(new CustomEvent("reset"))):-1!=e.name.indexOf(t)&&(e.value="",e.dispatchEvent(new CustomEvent("reset")))}),this.drawer_filters.forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.id=="drawer-"+t&&(e.checked=!1,e.dispatchEvent(new CustomEvent("reset"))):-1!=e.name.indexOf("drawer-"+t)&&(e.value="",e.dispatchEvent(new CustomEvent("reset")))}),this.updateQuery(),this.updateURL(),this.fetchProducts()}removeTag(t){this.filters.forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.value==t&&(e.checked=!1,e.dispatchEvent(new CustomEvent("reset"))):-1!=e.value.indexOf(t)&&(e.value="",e.dispatchEvent(new CustomEvent("reset")))}),this.drawer_filters.forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.value==t&&(e.checked=!1,e.dispatchEvent(new CustomEvent("reset"))):-1!=e.value.indexOf(t)&&(e.value="",e.dispatchEvent(new CustomEvent("reset")))}),this.updateQuery(),this.updateURL(),this.fetchProducts()}fetchProducts(){this.is_loading||(this.is_loading=!0,document.body.classList.add("wait"),fetch(this.base_url+"?"+this.query.toString(),{method:"GET"}).then(e=>e.text()).then(e=>{var t=document.createElement("div"),e=(t.innerHTML=e,t.querySelector(".drawer .filters")),t=t.querySelector(".listing");e&&(this.drawer.innerHTML=e.innerHTML),t&&(this.content.innerHTML=t.querySelector(".listing__content").innerHTML,this.current_filters.innerHTML=t.querySelector(".filters__main").innerHTML,this.current_chips.innerHTML=t.querySelector(".listing__toolbar-filters").innerHTML,this.count.innerHTML=t.querySelector(".listing__toolbar-count").innerHTML,e=t.querySelector(".listing__toolbar-count")?parseInt(t.querySelector(".listing__toolbar-count").getAttribute("data-count")):0,this.pagination&&(t.querySelector(".pagination")?this.pagination.innerHTML=t.querySelector(".pagination").innerHTML:this.pagination.innerHTML=""),this.grid=this.querySelector(".listing__grid"),this.bindFilters(),this.formatReviewsCount(),this.changeLayout(),this.updateCounter(e),window.dispatchEvent(new Event("resize"))),setTimeout(()=>{this.is_loading=!1,document.body.classList.remove("wait")},500)}))}bindFilters(){var e;this.filters=this.querySelectorAll("input[name]"),this.drawer_filters=document.querySelectorAll(".drawer .filters input[name]"),this.filters.forEach(r=>{r.addEventListener("change",()=>{const t=r.getAttribute("data-filter-sync");t&&r.closest(".filter-sync").querySelectorAll("input[name]").forEach(e=>{e!=r&&-1!=e.getAttribute("data-filter-sync").indexOf(t)&&(e.checked=r.checked)}),"radio"!=r.type&&"checkbox"!=r.type||this.pushHistory({name:r.name,value:r.value,checked:!r.checked,type:r.type}),r.getAttribute("data-last-value")&&this.pushHistory({name:r.name,value:r.getAttribute("data-last-value"),type:r.type}),localStorage.setItem("bernstein-last-filter",r.name),this.updateQuery(),this.updateURL(),this.fetchProducts()})}),this.drawer_filters.forEach(t=>{const r=t.name.replace("drawer-","");t.addEventListener("change",()=>{let e=void 0;if("checkbox"==t.type||"radio"==t.type){if(!(e=this.querySelector(`input[name="${r}"][value="${t.value}"]`)))return;e.checked=t.checked}else{if(!(e=this.querySelector(`input[name="${r}"]`)))return;e.value=t.value}setTimeout(()=>{e.dispatchEvent(new Event("change"))})})}),localStorage.getItem("bernstein-last-filter")&&(e=localStorage.getItem("bernstein-last-filter"),this.querySelectorAll(`input[name="${e}"]`).forEach(e=>{e=e.closest("dropdown-select");"function"==typeof e.open&&e&&e.open()}),this.drawer_filters=document.querySelectorAll(`.drawer .filters input[name="drawer-${e}"]`).forEach(e=>{e=e.closest("details");e&&(e.open=!0)}),localStorage.removeItem("bernstein-last-filter")),document.querySelectorAll("[data-reset-filters]").forEach(e=>{e.addEventListener("click",()=>{this.is_loading=!0,document.body.classList.add("wait")})}),document.querySelectorAll("[data-remove-filter]").forEach(e=>{e.addEventListener("click",()=>{this.removeFilter(e.getAttribute("data-remove-filter"))})}),document.querySelectorAll("[data-remove-tag]").forEach(e=>{e.addEventListener("click",()=>{this.removeTag(e.getAttribute("data-remove-tag"))})})}updateCounter(r){this.count_filters.forEach(e=>{var t=e.getAttribute("data-filters-count").split(",");e.innerHTML=0<r?1<r?r+" "+t[2]:r+" "+t[0]:" "+t[2]})}pushHistory(e){var t=localStorage.getItem("stackFilters")?JSON.parse(localStorage.getItem("stackFilters")):[];t.push(e),localStorage.setItem("stackFilters",JSON.stringify(t))}popHistory(){var e=localStorage.getItem("stackFilters")?JSON.parse(localStorage.getItem("stackFilters")):[];e.pop(),localStorage.setItem("stackFilters",JSON.stringify(e))}formatReviewsCount(){this.content.querySelectorAll(".jdgm-prev-badge__text").forEach(e=>{var t=e.innerHTML.replace("reviews","review").split(" review");e.innerHTML=`(${t[0].replace(/\s/g,"")})`,e.style.visibility="visible"})}}customElements.define("collection-section",a)}