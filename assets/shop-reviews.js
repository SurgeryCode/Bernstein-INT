if(!customElements.get("reviews-section")){class a extends HTMLElement{constructor(){super(),this.channel=this.getAttribute("data-channel"),this.end=!1,this.swiper=void 0,this.data=[],this.page=1,this.container=this.querySelector(".swiper-wrapper"),this.button_filter=this.querySelectorAll("[data-filter-button]"),this.average=this.querySelector("[data-reviews-average]"),this.average_stars=this.querySelector(".reviews__summary-stars"),this.reviews_count=this.querySelector("[data-total-reviews-count]"),this.height=0,this.empty=this.querySelector(".reviews__empty"),this.initSwiper(),this.fetchSummary(),this.fetchReviews(),this.button_filter.forEach(e=>{e.addEventListener("click",()=>{let t=0;const i=e.getAttribute("data-filter-button");this.button_filter.forEach(e=>e.setAttribute("aria-expanded","false")),e.setAttribute("aria-expanded","true"),this.container.innerHTML="","all"==i?this.data.forEach(e=>{this.drawItem(e),t++}):this.data.forEach(e=>{e.rating==i&&(this.drawItem(e),t++)}),this.swiper.update(),this.swiper.slideTo(0,0),this.fetchProducts(),this.matchHeight(),0<t?this.empty.style.display="none":this.empty.style.display="block"})})}fetchSummary(){fetch("https://etrusted.bernstein.store/api/channels/"+this.channel,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(i=>{i.data&&(this.average.innerText=i.data.average_rating.toFixed(2),this.reviews_count.innerText=i.data.total_reviews,this.average_stars.setAttribute("data-stars",Math.ceil(i.data.average_rating)),this.button_filter.forEach(e=>{var t;e.querySelector("[data-reviews-count]")&&(t=e.getAttribute("data-filter-handle"),i.data[t])&&(e.querySelector("[data-reviews-count]").innerText=`(${i.data[t]})`)}))})}fetchReviews(){fetch(`https://etrusted.bernstein.store/api/reviews?channel=${this.channel}&per_page=100&page=`+this.page,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.data.forEach(e=>{this.data.push(e),this.drawItem(e)}),e.links.next&&(this.page++,this.fetchReviews()),this.swiper.update(),this.fetchProducts(),this.matchHeight()})}fetchProducts(){this.container.querySelectorAll(".reviews__product").forEach(t=>{var e;0==t.childNodes.length&&(e=t.getAttribute("data-sku"),fetch(routes.search_url+`?type=product&q=variants.sku:${e}&view=sku`).then(e=>e.text()).then(e=>{t.innerHTML=e,this.matchHeight()}))})}initSwiper(){this.swiper=new Swiper(this.querySelector(".swiper-container"),{loop:!1,grabCursor:!0,speed:500,spaceBetween:16,slidesPerView:"auto",watchSlidesProgress:!0,setWrapperSize:!0,observer:!0,observeSlideChildren:!0,breakpoints:{768:{spaceBetween:24,slidesPerView:"auto"},1200:{spaceBetween:24,slidesPerView:3}}})}drawItem(i){if(i.comment||i.product_sku){var s=document.createElement("div"),a=parseInt(i.rating);let t="",e="";i.product_sku&&(e=`<div class="reviews__product" data-sku=${i.product_sku}></div>`);for(let e=1;e<6;e++)t+=`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.524.964a.5.5 0 0 1 .952 0l.983 3.027a.5.5 0 0 0 .476.346h3.184a.5.5 0 0 1 .293.904L8.837 7.113a.5.5 0 0 0-.182.559L9.64 10.7a.5.5 0 0 1-.77.559L6.295 9.387a.5.5 0 0 0-.588 0L3.13 11.26a.5.5 0 0 1-.769-.56l.984-3.027a.5.5 0 0 0-.182-.56L.588 5.243a.5.5 0 0 1 .293-.905h3.184a.5.5 0 0 0 .476-.346L5.524.964Z" fill="${a>=e?"#111111":"#e5e5e5"}"/></svg>`;s.classList.add("swiper-slide"),s.setAttribute("data-rating",i.rating),s.innerHTML=`<div class="reviews__item"><span class="label">${window.accessibility.verified}</span><div class="reviews__item-header"><div class="reviews__item-stars">${t}</div><time class="f-14 gray">${this.formatDate(i.submitted_at)}</time></div><p>${i.comment||""}</p>${e}</div>`,this.container.append(s),this.empty.style.display="none"}}formatDate(e){e=new Date(e);return`${e.getDate()} ${window.accessibility.months[e.getMonth()].substring(0,3)} `+e.getFullYear()}matchHeight(){this.container.querySelectorAll(".reviews__item").forEach(e=>{e.offsetHeight>this.height&&(this.height=e.offsetHeight)}),this.style.setProperty("--box-height",this.height+"px")}}customElements.define("reviews-section",a)}