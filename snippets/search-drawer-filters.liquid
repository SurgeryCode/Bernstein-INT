<link rel="stylesheet" href="{{ 'section-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<noscript>
    {{ 'section-drawer.css' | asset_url | stylesheet_tag }}
</noscript>
<script src="{{ 'drawer.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'details.js' | asset_url }}" defer="defer"></script>

{%- liquid 
    assign sort_options = 'best-selling,price-ascending,price-descending,created-ascending' | split: ','
    assign categories = linklists['categories'].links | map: 'title'
-%}

<drawer-section class="drawer" id="drawer-search-filters" tabindex="-1">
    <div class="drawer__content">
        <button 
            title="{{ 'accessibility.close' | t }}" 
            aria-label="{{ 'accessibility.close' | t }}"
            class="drawer__close"
            data-drawer-close>
                {%- render 'svg-icon', name: 'close' -%}
        </button>

        <div class="drawer__header">
            <span class="f-24 w-bold">{{ 'collection.filter_sort' | t }}</span>
        </div>

        <div class="drawer__scroll filters">
            <div class="drawer__scroll-inner drawer__scroll-inner--offset">           
                <details-block class="details" id="details-{{ 'collection.sort.title' | t | handleize }}">
                    <details class="drawer__scroll-sort">
                        <summary>
                            <p class="f-16 w-medium">{{ 'collection.sort.title' | t }}</p>
                            {%- render 'svg-icon', name: 'chevron-down' -%}
                        </summary>
                        <div class="details__content details__content--filters">
                            {%- for option in sort_options -%}
                                <label for="drawer-sort-{{ option }}" class="checkbox">
                                    <input 
                                        type="radio"
                                        name="drawer-sort_by"
                                        value="{{ option }}"
                                        id="drawer-sort-{{ option }}"
                                        {% if search.sort_by == option or forloop.first -%}checked{%- endif %}>
                                            {%- render 'svg-icon', name: 'radio' -%}
                                            <span>{{ 'collection.sort.' | append: option | t }}</span>
                                </label>   
                            {%- endfor -%}
                        </div>
                    </details>
                </details-block>

                {%- for filter in search.filters -%}
                    {%- unless filter.label == 'Tags' or filter.param_name == 'filter.p.m.filter.coll' -%}
                        <details-block class="details" id="details-{{ filter.param_name }}">
                            <details>
                                <summary>
                                    <p class="f-16 w-medium">{{ filter.label }}</p>
                                    {%- render 'svg-icon', name: 'chevron-down' -%}
                                </summary>
                                <div class="details__content details__content--filters">
                                    {%- if filter.type == 'list' -%}
                                        {%- for filter_value in filter.values -%}
                                            <label for="drawer-filter-{{ filter.param_name }}-{{ forloop.index }}" class="checkbox">
                                                <input 
                                                    type="checkbox"
                                                    name="drawer-{{ filter_value.param_name }}"
                                                    value="{{ filter_value.value }}"
                                                    id="drawer-filter-{{ filter.param_name }}-{{ forloop.index }}"
                                                    {% if filter_value.active -%}checked{%- endif %}>
                                                        {%- render 'svg-icon', name: 'checkbox' -%}
                                                        <span>{{ filter_value.label }}</span>
                                            </label>
                                        {%- endfor -%}
                                    {%- endif -%}
                                    {%- if filter.type == 'price_range' -%}
                                        {%- assign range = filter.range_max | amount_no_decimals | divided_by: 100 -%}
                                        <range-slider class="filters__range">
                                            <p class="w-medium">{{ filter.label }} ({{ cart.currency.symbol }})</p>
                                            <div class="filters__range-grid">
                                                <input 
                                                    type="number" 
                                                    name="drawer-{{ filter.min_value.param_name }}" 
                                                    placeholder="0" 
                                                    data-from-input
                                                    {% if filter.min_value.value %}value="{{ filter.min_value.value | divided_by: 100 }}"{% endif %}>
                                                <input 
                                                    type="number" 
                                                    name="drawer-{{ filter.max_value.param_name }}" 
                                                    placeholder="{{ range }}" 
                                                    data-to-input
                                                    {% if filter.max_value.value %}value="{{ filter.max_value.value | divided_by: 100 }}"{% endif %}>
                                            </div>
                                            <input 
                                                type="hidden"
                                                data-range
                                                data-min="0"
                                                data-max="{{ range }}">
                                        </range-slider>
                                    {%- endif -%}
                                </div>
                            </details>
                        </details-block>
                    {%- endunless -%}
                {%- endfor -%}
            </div>
        </div>

        <div class="drawer__buttons drawer__buttons--border">
            <button class="button button--large" data-drawer-close style="gap:0.25rem;">   
                {{ 'collection.filters.submit_html' | t }}
            </button>
            <a href="{{ collection.url }}" class="text-link text-link--reverse f-14 w-medium upper spaced" data-reset-filters>
                <span>{{ 'collection.filters.reset' | t }}</span>
            </a>
        </div>
    </div>
</drawer-section>