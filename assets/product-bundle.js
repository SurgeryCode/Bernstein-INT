if(!customElements.get("product-bundle")){class a extends HTMLElement{constructor(){super(),this.container=this.querySelector(".bundle__components"),this.components=void 0,this.total=this.querySelector("[data-bundle-total]"),this.button=this.querySelector("[data-bundle-submit]"),this.getAttribute("data-sku")&&(this.sku=this.getAttribute("data-sku").split(","),this.fetchErpRecommendations()),this.button.addEventListener("click",()=>{this.submit()})}async fetchErpRecommendations(){var t=this.sku.map(t=>fetch(routes.search_url+`?type=product&q=variants.sku:${t}&view=sku-bundle`).then(t=>t.text()));let e=0;for(const n of await Promise.all(t)){var s=document.createElement("div");s.innerHTML=n,s.classList.add("bundle__components-item"),s&&s.innerHTML.trim().length&&(this.container.append(s),e++)}0<e&&(this.bind(),this.update(),this.closest(".bundle").style.display="block")}bind(){this.components=this.querySelectorAll("[data-bundle-component]"),this.components&&this.components.forEach(e=>{const t=e.closest("product-item"),s=e.closest("dropdown-select");this.addEventListener("change",()=>{this.update(),e.checked&&(s&&(s.querySelector("[data-dropdown-button] > span").innerText=""+e.getAttribute("data-title"),s.close()),t.querySelectorAll("[data-variant-detail]").forEach(t=>{t.getAttribute("data-variant-detail")==e.value?t.classList.add("selected"):t.classList.remove("selected")}))})})}update(){if(this.total){let e=0;this.components.forEach(t=>{("hidden"==t.type||t.checked)&&(e+=parseInt(t.dataset.bundleComponent))}),this.total.innerText=""+window.theme.format_money(e)}}submit(){this.button.classList.add("button--loading");const e={items:[]};this.components.forEach(t=>{"hidden"!=t.type&&!t.checked||e.items.push({id:t.value,quantity:1})}),fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t.items&&(window.dispatchEvent(new CustomEvent("drawerOpen",{detail:{id:"drawer-product-upsell"}})),window.dispatchEvent(new CustomEvent("cartCounterUpdate"))),this.button.classList.remove("button--loading")})}}customElements.define("product-bundle",a)}