class Cart extends HTMLElement{constructor(){super(),this.loading=!1,this.submitButton=this.querySelector('.cart-details button[type="submit"]'),this.submitButton&&this.submitButton.addEventListener("click",()=>{localStorage.removeItem("bernstein-cart-updated"),localStorage.removeItem("bernstein-bubble-closed")}),window.addEventListener("cartViewUpdate",t=>{window.location.href=window.location.href});const e=parseInt(this.getAttribute("data-items-count"));fetch("/cart.js",{method:"GET"}).then(t=>t.json()).then(t=>{e!==t.item_count?window.location.href=window.location.href:this.setLoading(!1)})}update(t){var e=(new DOMParser).parseFromString(t.section,"text/html").querySelector("cart-main");new URL(location);this.closest("section#shopify-section-"+this.id).replaceChild(e,this),this.setLoading(!1),document.dispatchEvent(new CustomEvent("cart:updated",{detail:t.items,bubbles:!1})),window.dispatchEvent(new CustomEvent("cartCounterUpdate"))}setLoading(t=!0){1==t?this.setAttribute("loading",!0):this.removeAttribute("loading")}}customElements.define("cart-main",Cart);class CartItem extends HTMLElement{constructor(){super(),this.cart=this.closest("cart-main"),this.lineKey=this.dataset.lineKey,this.quantityInput=this.querySelector("quantity-field input"),this.removeButton=this.querySelector(".cart-item__actions__remove a"),this.warranty=this.querySelector(".cart-item__warranty"),this.warrantyCheckbox=this.querySelector(".cart-item__warranty__checkmark input"),this.removeButton.addEventListener("click",t=>this.changeQuantity(t,!0)),this.quantityInput.addEventListener("change",this.debounce(this.changeQuantity,400)),this.warrantyCheckbox&&this.warrantyCheckbox.addEventListener("change",t=>this.toggleWarranty(t,t.target.checked))}debounce(e,a){let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,t),a)}}toggleWarranty(t,e=!1){t.preventDefault(),this.cart.setLoading();var t=Object.fromEntries(JSON.parse(this.dataset.properties?.replaceAll("=>",":")||"{}")),a=JSON.parse(this.dataset.warranty?.replaceAll("=>",":")||"{}");let i=t;var r=this.warranty.dataset.warrantyKey,n=this.warranty.dataset.warrantyName;const s=parseInt(this.quantityInput.value),o=this.dataset.variantId;a&&(t=t._warranty,e&&null==t?(i._warranty=[{id:a.id}],i[r]=n):e||null==t||(delete i._warranty,i[r]&&delete i[r]),fetch(window.Shopify.routes.root+"cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.lineKey,quantity:0})}).then(t=>t.json()).then(t=>{var e={items:[{id:o,quantity:s,properties:i}],sections:this.cart.id};fetch(window.Shopify.routes.root+"cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{if(!t.sections[this.cart.id])return new Error(t.message);var e=t.sections[this.cart.id];this.cart.update({section:e,count:t.item_count,items:t.items}),0<t.item_count?localStorage.setItem("bernstein-cart-updated",Date.now()):localStorage.removeItem("bernstein-cart-updated")}).catch(t=>{console.error("Error:",t),this.cart.setLoading(!1)})}))}changeQuantity(t,e=!1){t.preventDefault(),this.cart.setLoading(),fetch(window.Shopify.routes.root+"cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.lineKey,quantity:e?0:t?.target?.value,sections:this.cart.id})}).then(t=>t.json()).then(t=>{if(!t.sections[this.cart.id])return new Error(t.message);var e=t.sections[this.cart.id];this.cart.update({section:e,count:t.item_count,items:t.items}),0<t.item_count?localStorage.setItem("bernstein-cart-updated",Date.now()):localStorage.removeItem("bernstein-cart-updated")}).catch(t=>{console.error("Error:",t),document.querySelector("cart-item").quantityInput.value=document.querySelector("cart-item").quantityInput.getAttribute("value"),this.cart.setLoading(!1)})}}customElements.define("cart-item",CartItem);