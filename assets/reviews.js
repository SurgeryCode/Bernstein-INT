if(!customElements.get("reviews-section")){class a extends HTMLElement{constructor(){super(),this.loading=!0,this.end=!1,this.swiper=void 0,this.data=[],this.endpoint="https://etrusted.bernstein.store/api/reviews?channel="+this.getAttribute("data-channel"),this.sku=!!this.getAttribute("data-sku")&&this.getAttribute("data-sku"),this.page=1,this.container=this.querySelector(".swiper-wrapper"),this.button_filter=this.querySelectorAll("[data-filter-button]"),this.average=this.querySelector("[data-reviews-average]"),this.average_stars=this.querySelector(".reviews__summary-stars"),this.reviews_count=this.querySelector("[data-total-reviews-count]"),this.tested=!1,this.initSwiper(),this.fetchReviews(),this.button_filter.forEach(t=>{t.addEventListener("click",()=>{this.loading=!1;var e=t.getAttribute("data-filter-button");this.button_filter.forEach(e=>e.setAttribute("aria-expanded","false")),t.setAttribute("aria-expanded","true"),this.classList.remove("reviews--all"),this.classList.remove("reviews--1"),this.classList.remove("reviews--2"),this.classList.remove("reviews--3"),this.classList.remove("reviews--4"),this.classList.remove("reviews--5"),this.classList.add("reviews--"+e),this.swiper.update()})}),window.addEventListener("variantChange",e=>{0<e.detail.sku.length?this.sku=e.detail.sku:this.sku="xxxxxxxxxx",this.data=[],this.container.innerHTML="",this.loading=!1,this.end=!1,this.page=1,this.fetchReviews()})}fetchReviews(){this.loading=!0;let e="";this.sku&&(e="&sku="+this.sku),fetch(this.endpoint+"&page="+this.page+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{this.loading=!1,e.data.forEach(e=>{this.data.push(e),this.drawItem(e)}),this.tested?(e.links.next?this.end=!1:this.end=!0,this.swiper.update(),this.updateCounters(),this.fetchProducts(),this.swiper.isEnd&&!this.end&&(this.page++,this.fetchReviews())):(this.tested=!0,e.data.length<1&&(this.style.display="none"))})}fetchProducts(){this.container.querySelectorAll(".reviews__product").forEach(t=>{var e;0==t.childNodes.length&&(e=t.getAttribute("data-sku"),fetch(routes.search_url+`?type=product&q=variants.sku:${e}&view=sku`).then(e=>e.text()).then(e=>{t.innerHTML=e}))})}initSwiper(){this.swiper=new Swiper(this.querySelector(".swiper-container"),{loop:!1,grabCursor:!0,speed:500,spaceBetween:16,slidesPerView:"auto",watchSlidesProgress:!0,breakpoints:{768:{spaceBetween:24,slidesPerView:"auto"},1200:{spaceBetween:24,slidesPerView:3}},on:{reachEnd:()=>{this.loading||(this.page++,this.fetchReviews())}}})}drawLoader(){var e=document.createElement("div");e.classList.add("swiper-slide"),e.innerHTML='<div class="reviews__item reviews__item--loader"></div>',this.container.append(e)}drawItem(e){var t=document.createElement("div"),s=parseInt(e.rating);let i="",a="";e.product_sku&&(a=`<div class="reviews__product" data-sku=${e.product_sku}></div>`);for(let e=1;e<6;e++)i+=`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.524.964a.5.5 0 0 1 .952 0l.983 3.027a.5.5 0 0 0 .476.346h3.184a.5.5 0 0 1 .293.904L8.837 7.113a.5.5 0 0 0-.182.559L9.64 10.7a.5.5 0 0 1-.77.559L6.295 9.387a.5.5 0 0 0-.588 0L3.13 11.26a.5.5 0 0 1-.769-.56l.984-3.027a.5.5 0 0 0-.182-.56L.588 5.243a.5.5 0 0 1 .293-.905h3.184a.5.5 0 0 0 .476-.346L5.524.964Z" fill="${s>=e?"#111111":"#e5e5e5"}"/></svg>`;t.classList.add("swiper-slide"),t.setAttribute("data-rating",e.rating),t.innerHTML=`<div class="reviews__item"><span class="label">${window.accessibility.verified}</span><div class="reviews__item-header"><div class="reviews__item-stars">${i}</div><time class="f-14 gray">${this.formatDate(e.submitted_at)}</time></div><p>${e.comment||""}</p>${a}</div>`,this.container.append(t)}updateCounters(){let t=0,e=(this.button_filter.forEach(e=>{if(e.querySelector("[data-reviews-count]")){const s=parseInt(e.getAttribute("data-filter-button"));var t=this.data.filter(e=>parseInt(e.rating)==s).length;e.querySelector("[data-reviews-count]").innerText=`(${t})`}}),this.data.forEach(e=>{t+=parseInt(e.rating)}),0);0<this.data.length&&(e=t/this.data.length),this.average.innerText=e.toFixed(2),this.average_stars.setAttribute("data-stars",Math.ceil(e)),this.reviews_count.innerText=this.data.length}formatDate(e){e=new Date(e);return`${e.getDate()} ${window.accessibility.months[e.getMonth()].substring(0,3)} `+e.getFullYear()}}customElements.define("reviews-section",a)}